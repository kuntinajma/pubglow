<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Jurnal - PubGlow</title>
  <link href="css/main-theme.css" rel="stylesheet">
  <style>
    .filters-sidebar {
      position: sticky;
      top: 80px;
    }
    
    .filter-section {
      margin-bottom: 24px;
    }
    
    .filter-section label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--color-text);
    }
    
    .scope-filter-group,
    .month-filter-group {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      padding: 12px;
      background: var(--color-bg-light);
    }
    
    .form-check {
      margin-bottom: 8px;
    }
    
    .form-check-input {
      margin-top: 0.2em;
    }
    
    .form-check-label {
      font-size: 13px;
      color: var(--color-text);
    }
    
    .month-filter-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .month-filter-group .form-check {
      margin: 0;
    }
    
    .price-range {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .journal-card {
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
      transition: var(--transition);
    }
    
    .journal-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-color: var(--color-primary);
    }
    
    .journal-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--color-primary);
    }
    
    .journal-meta {
      display: grid;
      gap: 8px;
      font-size: 14px;
      margin-bottom: 16px;
    }
    
    .journal-meta-item {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    
    .journal-meta-label {
      font-weight: 500;
      color: var(--color-text-light);
      min-width: 110px;
    }
    
    .journal-meta-value {
      color: var(--color-text);
    }
    
    .fast-track-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--color-primary);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      margin-top: 8px;
    }
    
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--color-border);
    }
    
    .result-count {
      font-size: 14px;
      color: var(--color-text-light);
    }
    
    .filter-buttons {
      display: grid;
      gap: 8px;
      margin-top: 24px;
    }
    
    @media (max-width: 992px) {
      .filters-sidebar {
        position: static;
        margin-bottom: 32px;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="main-navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-brand">PubGlow</a>
      <button class="navbar-toggle" id="navToggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="navbar-menu" id="navMenu">
        <li><a href="index.html">Beranda</a></li>
        <li><a href="journals.html" class="active">Jurnal</a></li>
        <li><a href="articles.html">Artikel</a></li>
        <li><a href="index.html#contribute">Kontributor</a></li>
      </ul>
    </div>
  </nav>

  <!-- Page Header -->
  <div class="container">
    <div class="page-header">
      <h1>Daftar Jurnal</h1>
      <p>Temukan jurnal terakreditasi yang sesuai dengan kebutuhan publikasi Anda</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container" style="padding-bottom:80px">
    <div style="display:grid;grid-template-columns:280px 1fr;gap:40px">
      <!-- Filters Sidebar -->
      <div class="filters-sidebar">
        <div class="card" style="padding:20px">
          <h3 style="font-size:16px;font-weight:600;margin-bottom:20px">Filter & Urutan</h3>
          
          <!-- Search -->
          <div class="filter-section">
            <label>Cari Jurnal</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Nama atau instansi">
          </div>

          <!-- Akreditasi -->
          <div class="filter-section">
            <label>Akreditasi</label>
            <select class="form-select" id="filterAkreditasi">
              <option value="">Semua</option>
              <option value="SINTA 1">SINTA 1</option>
              <option value="SINTA 2">SINTA 2</option>
              <option value="SINTA 3">SINTA 3</option>
              <option value="SINTA 4">SINTA 4</option>
              <option value="SINTA 5">SINTA 5</option>
              <option value="SINTA 6">SINTA 6</option>
              <option value="Non-SINTA">Non-SINTA</option>
              <option value="Scopus Q1">Scopus Q1</option>
              <option value="Scopus Q2">Scopus Q2</option>
              <option value="Scopus Q3">Scopus Q3</option>
              <option value="Scopus Q4">Scopus Q4</option>
            </select>
          </div>

          <!-- Scope -->
          <div class="filter-section">
            <label>Bidang Ilmu</label>
            <div id="scopeFilterContainer" class="scope-filter-group">
              <div style="text-align:center;color:var(--color-text-light);font-size:12px">Loading...</div>
            </div>
          </div>

          <!-- Jadwal Terbit -->
          <div class="filter-section">
            <label>Jadwal Terbit</label>
            <div class="month-filter-group">
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Januari" id="mf_jan">
                <label class="form-check-label" for="mf_jan">Jan</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Februari" id="mf_feb">
                <label class="form-check-label" for="mf_feb">Feb</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Maret" id="mf_mar">
                <label class="form-check-label" for="mf_mar">Mar</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="April" id="mf_apr">
                <label class="form-check-label" for="mf_apr">Apr</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Mei" id="mf_may">
                <label class="form-check-label" for="mf_may">Mei</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Juni" id="mf_jun">
                <label class="form-check-label" for="mf_jun">Jun</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Juli" id="mf_jul">
                <label class="form-check-label" for="mf_jul">Jul</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Agustus" id="mf_aug">
                <label class="form-check-label" for="mf_aug">Agu</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="September" id="mf_sep">
                <label class="form-check-label" for="mf_sep">Sep</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Oktober" id="mf_oct">
                <label class="form-check-label" for="mf_oct">Okt</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="November" id="mf_nov">
                <label class="form-check-label" for="mf_nov">Nov</label>
              </div>
              <div class="form-check">
                <input class="form-check-input month-filter" type="checkbox" value="Desember" id="mf_dec">
                <label class="form-check-label" for="mf_dec">Des</label>
              </div>
            </div>
          </div>

          <!-- Harga -->
          <div class="filter-section">
            <label>Rentang Harga (Rp)</label>
            <div class="price-range">
              <input type="number" class="form-control" id="priceMin" placeholder="Min" step="100000">
              <input type="number" class="form-control" id="priceMax" placeholder="Max" step="100000">
            </div>
          </div>

          <!-- Fast Track -->
          <div class="filter-section">
            <label>Fast Track</label>
            <select class="form-select" id="filterFastTrack">
              <option value="">Semua</option>
              <option value="ya">Ada</option>
              <option value="tidak">Tidak Ada</option>
            </select>
          </div>

          <!-- Sort -->
          <div class="filter-section">
            <label>Urutkan</label>
            <select class="form-select" id="sortBy">
              <option value="">Default</option>
              <option value="harga-asc">Harga Termurah</option>
              <option value="harga-desc">Harga Termahal</option>
              <option value="review-asc">Review Tercepat</option>
            </select>
          </div>

          <div class="filter-buttons">
            <button class="btn btn-primary" id="btnApplyFilter">Terapkan</button>
            <button class="btn btn-outline" id="btnResetFilter">Reset</button>
          </div>
        </div>
      </div>

      <!-- Journals List -->
      <div>
        <div class="result-header">
          <div class="result-count"><strong id="resultCount">0</strong> jurnal ditemukan</div>
          <a href="submit-journal.html" class="btn btn-outline" style="padding:8px 16px;font-size:13px">Kontribusi Jurnal</a>
        </div>
        <div id="journalsList">
          <div style="text-align:center;padding:60px 0">
            <div style="width:24px;height:24px;border:2px solid var(--color-border);border-top-color:var(--color-primary);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 16px"></div>
            <p style="color:var(--color-text-light);font-size:14px">Memuat data jurnal...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="footer-container">
      <div class="footer-content">
        <div>
          <div class="footer-brand">PubGlow</div>
          <p class="footer-description">Platform terpadu untuk publikasi jurnal dan artikel ilmiah. Mendukung ekosistem penelitian Indonesia dengan informasi lengkap dan terkini.</p>
        </div>
        <div class="footer-section">
          <h4>Platform</h4>
          <ul class="footer-links">
            <li><a href="index.html">Beranda</a></li>
            <li><a href="journals.html">Jurnal</a></li>
            <li><a href="articles.html">Artikel</a></li>
            <li><a href="index.html#contribute">Kontributor</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Lainnya</h4>
          <ul class="footer-links">
            <li><a href="submit-journal.html">Submit Jurnal</a></li>
            <li><a href="submit-article.html">Submit Artikel</a></li>
            <li><a href="login.html">Admin Login</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        &copy; 2025 PubGlow. Platform Publikasi Jurnal & Artikel Ilmiah.
      </div>
    </div>
  </footer>

  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>

  <script type="module">
    import { db } from './js/firebase.js';
    import { collection, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
    import { trackVisitor } from './js/visitor-tracker.js';

    trackVisitor();

    document.getElementById('navToggle').addEventListener('click', () => {
      document.getElementById('navMenu').classList.toggle('active');
    });

    let allJournals = [];

    async function loadScopesFilter() {
      try {
        const snapshot = await getDocs(collection(db, 'scopes'));
        if (snapshot.empty) {
          document.getElementById('scopeFilterContainer').innerHTML = '<p style="font-size:12px;color:var(--color-text-light);margin:0">Belum ada scope</p>';
          return;
        }
        let html = '';
        snapshot.forEach(doc => {
          const scope = doc.data().nama;
          html += `
            <div class="form-check">
              <input class="form-check-input scope-filter" type="checkbox" value="${scope}" id="sf_${doc.id}">
              <label class="form-check-label" for="sf_${doc.id}">${scope}</label>
            </div>
          `;
        });
        document.getElementById('scopeFilterContainer').innerHTML = html;
      } catch (error) {
        console.error(error);
      }
    }

    async function loadJournals() {
      try {
        const q = query(collection(db, 'journals'), where('status', '==', 'aktif'));
        const snapshot = await getDocs(q);
        if (snapshot.empty) {
          document.getElementById('journalsList').innerHTML = '<div class="card" style="padding:40px;text-align:center"><p style="color:var(--color-text-light);margin:0">Belum ada jurnal dipublikasikan</p></div>';
          return;
        }
        allJournals = [];
        snapshot.forEach(doc => {
          allJournals.push({ id: doc.id, ...doc.data() });
        });
        applyFiltersAndSort();
      } catch (error) {
        console.error(error);
      }
    }

    function applyFiltersAndSort() {
      let filtered = [...allJournals];
      
      // Search filter
      const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
      if (searchTerm) {
        filtered = filtered.filter(j => j.nama.toLowerCase().includes(searchTerm) || j.instansi.toLowerCase().includes(searchTerm));
      }
      
      // Akreditasi filter
      const akreditasi = document.getElementById('filterAkreditasi').value;
      if (akreditasi) filtered = filtered.filter(j => j.akreditasi === akreditasi);
      
      // Scope filter
      const selectedScopes = Array.from(document.querySelectorAll('.scope-filter:checked')).map(cb => cb.value);
      if (selectedScopes.length > 0) {
        filtered = filtered.filter(j => {
          const journalScopes = Array.isArray(j.scope) ? j.scope : [j.scope];
          return selectedScopes.some(s => journalScopes.includes(s));
        });
      }
      
      // Month filter (Jadwal Terbit)
      const selectedMonths = Array.from(document.querySelectorAll('.month-filter:checked')).map(cb => cb.value);
      if (selectedMonths.length > 0) {
        filtered = filtered.filter(j => {
          const journalMonths = Array.isArray(j.jadwalTerbit) ? j.jadwalTerbit : [];
          return selectedMonths.some(m => journalMonths.includes(m));
        });
      }
      
      // Price range filter
      const priceMin = parseInt(document.getElementById('priceMin').value) || 0;
      const priceMax = parseInt(document.getElementById('priceMax').value) || Infinity;
      filtered = filtered.filter(j => j.harga >= priceMin && j.harga <= priceMax);
      
      // Fast Track filter
      const fastTrack = document.getElementById('filterFastTrack').value;
      if (fastTrack === 'ya') {
        filtered = filtered.filter(j => j.fastTrack === 'Ada');
      } else if (fastTrack === 'tidak') {
        filtered = filtered.filter(j => j.fastTrack !== 'Ada');
      }
      
      // Sort
      const sortBy = document.getElementById('sortBy').value;
      if (sortBy === 'harga-asc') filtered.sort((a, b) => a.harga - b.harga);
      else if (sortBy === 'harga-desc') filtered.sort((a, b) => b.harga - a.harga);
      
      displayJournals(filtered);
    }

    function displayJournals(journals) {
      document.getElementById('resultCount').textContent = journals.length;
      if (journals.length === 0) {
        document.getElementById('journalsList').innerHTML = '<div class="card" style="padding:40px;text-align:center"><p style="color:var(--color-text-light);margin:0">Tidak ada jurnal yang sesuai filter</p></div>';
        return;
      }
      let html = '';
      journals.forEach(j => {
        const scopes = Array.isArray(j.scope) ? j.scope : [j.scope];
        const scopeBadges = scopes.map(s => `<span class="badge">${s}</span>`).join(' ');
        
        // Jadwal Terbit
        const jadwalTerbit = Array.isArray(j.jadwalTerbit) && j.jadwalTerbit.length > 0
          ? j.jadwalTerbit.join(', ')
          : (j.frekuensi || 'N/A');
        
        // Fast Track Badge
        let fastTrackHTML = '';
        if (j.fastTrack === 'Ada') {
          const fastTrackPrice = j.fastTrackBiaya ? `Rp ${j.fastTrackBiaya.toLocaleString('id-ID')}` : 'Hubungi jurnal';
          fastTrackHTML = `
            <div class="journal-meta-item">
              <span class="fast-track-badge">âš¡ Fast Track Tersedia - ${fastTrackPrice}</span>
            </div>
          `;
        }
        
        html += `
          <div class="journal-card">
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:16px">
              <h3 class="journal-title">${j.nama}</h3>
              <span class="badge badge-primary">${j.akreditasi}</span>
            </div>
            <div class="journal-meta">
              <div class="journal-meta-item">
                <span class="journal-meta-label">Instansi</span>
                <span class="journal-meta-value">${j.instansi}</span>
              </div>
              <div class="journal-meta-item">
                <span class="journal-meta-label">Bidang Ilmu</span>
                <span class="journal-meta-value">${scopeBadges}</span>
              </div>
              <div class="journal-meta-item">
                <span class="journal-meta-label">Biaya</span>
                <span class="journal-meta-value">Rp ${j.harga?.toLocaleString('id-ID')}</span>
              </div>
              <div class="journal-meta-item">
                <span class="journal-meta-label">Waktu Review</span>
                <span class="journal-meta-value">${j.waktuReview}</span>
              </div>
              <div class="journal-meta-item">
                <span class="journal-meta-label">Jadwal Terbit</span>
                <span class="journal-meta-value">${jadwalTerbit}</span>
              </div>
              ${fastTrackHTML}
            </div>
            <a href="${j.tautan}" target="_blank" class="btn btn-primary" style="padding:8px 16px;font-size:13px">Kunjungi Website</a>
          </div>
        `;
      });
      document.getElementById('journalsList').innerHTML = html;
    }

    document.getElementById('btnApplyFilter').addEventListener('click', applyFiltersAndSort);
    document.getElementById('btnResetFilter').addEventListener('click', () => {
      document.getElementById('searchInput').value = '';
      document.getElementById('filterAkreditasi').value = '';
      document.getElementById('priceMin').value = '';
      document.getElementById('priceMax').value = '';
      document.getElementById('filterFastTrack').value = '';
      document.getElementById('sortBy').value = '';
      document.querySelectorAll('.scope-filter').forEach(cb => cb.checked = false);
      document.querySelectorAll('.month-filter').forEach(cb => cb.checked = false);
      applyFiltersAndSort();
    });
    
    document.getElementById('searchInput').addEventListener('input', applyFiltersAndSort);
    document.getElementById('filterAkreditasi').addEventListener('change', applyFiltersAndSort);
    document.getElementById('filterFastTrack').addEventListener('change', applyFiltersAndSort);
    document.getElementById('sortBy').addEventListener('change', applyFiltersAndSort);

    loadScopesFilter();
    loadJournals();
  </script>
</body>
</html>