<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar Jurnal - PubGlow</title>
  
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/pages.css">
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>P</text></svg>">
</head>
<body>
  <nav class="navbar">
    <div class="container container-xl navbar-container">
      <a href="index.html" class="navbar-brand">PubGlow</a>
      
      <button class="navbar-toggle" id="navbarToggle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      
      <ul class="navbar-menu" id="navbarMenu">
        <li><a href="index.html" class="navbar-link">Beranda</a></li>
        <li><a href="jurnal.html" class="navbar-link active">Jurnal</a></li>
        <li><a href="blog.html" class="navbar-link">Blog</a></li>
        <li><a href="submit-jurnal.html" class="navbar-link">Usulkan Jurnal</a></li>
        <li><a href="submit-artikel.html" class="navbar-link">Usulkan Artikel</a></li>
      </ul>
    </div>
  </nav>

  <div class="container container-xl" style="padding-top: var(--space-8); padding-bottom: var(--space-12);">
    <div class="page-header">
      <h1 class="page-title">Daftar Jurnal</h1>
      <p class="page-subtitle">Temukan jurnal yang sesuai dengan kebutuhan publikasi Anda</p>
    </div>

    <div class="jurnal-filters">
      <div class="filter-row">
        <div class="input-group" style="margin: 0;">
          <label class="input-label">Cari Jurnal</label>
          <input type="text" id="searchInput" class="input" placeholder="Nama jurnal atau instansi...">
        </div>
        
        <div class="input-group" style="margin: 0;">
          <label class="input-label">Akreditasi</label>
          <select id="filterAkreditasi" class="select">
            <option value="">Semua</option>
            <option value="Sinta 1">Sinta 1</option>
            <option value="Sinta 2">Sinta 2</option>
            <option value="Sinta 3">Sinta 3</option>
            <option value="Sinta 4">Sinta 4</option>
            <option value="Sinta 5">Sinta 5</option>
            <option value="Sinta 6">Sinta 6</option>
          </select>
        </div>
        
        <div class="input-group" style="margin: 0;">
          <label class="input-label">Scope</label>
          <select id="filterScope" class="select">
            <option value="">Semua</option>
            <option value="Nasional">Nasional</option>
            <option value="Internasional">Internasional</option>
          </select>
        </div>
      </div>

      <div class="filter-row">
        <div class="input-group" style="margin: 0;">
          <label class="input-label">Harga</label>
          <select id="filterHarga" class="select">
            <option value="">Semua</option>
            <option value="gratis">Gratis</option>
            <option value="0-500000">< Rp 500.000</option>
            <option value="500000-1000000">Rp 500.000 - Rp 1.000.000</option>
            <option value="1000000-2000000">Rp 1.000.000 - Rp 2.000.000</option>
            <option value="2000000+">> Rp 2.000.000</option>
          </select>
        </div>
        
        <div class="input-group" style="margin: 0;">
          <label class="input-label">Fast Track</label>
          <select id="filterFastTrack" class="select">
            <option value="">Semua</option>
            <option value="ya">Ada</option>
            <option value="tidak">Tidak Ada</option>
          </select>
        </div>
        
        <div class="input-group" style="margin: 0;">
          <label class="input-label">Urutkan</label>
          <select id="sortBy" class="select">
            <option value="nama">Nama (A-Z)</option>
            <option value="harga-asc">Harga (Rendah-Tinggi)</option>
            <option value="harga-desc">Harga (Tinggi-Rendah)</option>
            <option value="akreditasi">Akreditasi (Terbaik)</option>
          </select>
        </div>
      </div>

      <div class="filter-actions">
        <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">
          Menampilkan <strong id="resultCount">0</strong> jurnal
        </div>
        <div style="display: flex; gap: var(--space-2);">
          <button class="btn btn-outline btn-sm" id="resetFilters">Reset Filter</button>
          <button class="btn btn-secondary btn-sm" id="exportExcel">Export Excel</button>
          <button class="btn btn-secondary btn-sm" id="exportPDF">Export PDF</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div id="jurnalTable">
        <div class="text-center" style="padding: 40px;">
          <div class="loader" style="margin: 0 auto 16px;"></div>
          <p style="color: var(--text-secondary);">Memuat data jurnal...</p>
        </div>
      </div>
      
      <div id="pagination" class="flex justify-center" style="margin-top: var(--space-6); padding-top: var(--space-6); border-top: 1px solid var(--border-color);"></div>
    </div>
  </div>

  <footer class="footer">
    <div class="container container-xl">
      <div class="footer-content">
        <div>
          <div class="footer-brand">PubGlow</div>
          <p style="color: var(--text-secondary); font-size: 14px; margin-top: 12px; max-width: 320px; line-height: 1.6;">
            Platform modern untuk menemukan jurnal ilmiah yang tepat.
          </p>
        </div>
        
        <div>
          <h4 class="footer-section-title">Navigasi</h4>
          <ul class="footer-links">
            <li><a href="index.html" class="footer-link">Beranda</a></li>
            <li><a href="jurnal.html" class="footer-link">Jurnal</a></li>
            <li><a href="blog.html" class="footer-link">Blog</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="footer-section-title">Kontribusi</h4>
          <ul class="footer-links">
            <li><a href="submit-jurnal.html" class="footer-link">Usulkan Jurnal</a></li>
            <li><a href="submit-artikel.html" class="footer-link">Usulkan Artikel</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="footer-section-title">Lainnya</h4>
          <ul class="footer-links">
            <li><a href="admin.html" class="footer-link">Admin Dashboard</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 PubGlow. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script type="module">
    import { getAllJournals } from './js/services/journalService.js';
    import { formatCurrency } from './js/utils/formatter.js';
    import { exportToExcel, exportToPDF } from './js/utils/export.js';
    import { showSuccess, showError } from './js/utils/notification.js';

    let allJournals = [];
    let filteredJournals = [];
    let currentPage = 1;
    const itemsPerPage = 20;

    document.getElementById('navbarToggle')?.addEventListener('click', () => {
      document.getElementById('navbarMenu')?.classList.toggle('active');
    });

    async function loadJournals() {
      try {
        allJournals = await getAllJournals();
        allJournals = allJournals.filter(j => j.status === 'active');
        filteredJournals = [...allJournals];
        applyFilters();
      } catch (error) {
        document.getElementById('jurnalTable').innerHTML = 
          '<div class="empty-state"><div class="empty-state-title">Gagal memuat data</div></div>';
      }
    }

    function applyFilters() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const akreditasi = document.getElementById('filterAkreditasi').value;
      const scope = document.getElementById('filterScope').value;
      const harga = document.getElementById('filterHarga').value;
      const fastTrack = document.getElementById('filterFastTrack').value;
      const sortBy = document.getElementById('sortBy').value;

      filteredJournals = allJournals.filter(j => {
        if (search && !j.nama.toLowerCase().includes(search) && !j.instansi.toLowerCase().includes(search)) return false;
        if (akreditasi && j.akreditasi !== akreditasi) return false;
        if (scope && j.scope !== scope) return false;
        if (fastTrack === 'ya' && !j.fastTrack) return false;
        if (fastTrack === 'tidak' && j.fastTrack) return false;
        
        if (harga) {
          const price = j.harga || 0;
          if (harga === 'gratis' && price !== 0) return false;
          if (harga === '0-500000' && (price < 0 || price > 500000)) return false;
          if (harga === '500000-1000000' && (price < 500000 || price > 1000000)) return false;
          if (harga === '1000000-2000000' && (price < 1000000 || price > 2000000)) return false;
          if (harga === '2000000+' && price < 2000000) return false;
        }
        
        return true;
      });

      // Sort
      if (sortBy === 'nama') {
        filteredJournals.sort((a, b) => a.nama.localeCompare(b.nama));
      } else if (sortBy === 'harga-asc') {
        filteredJournals.sort((a, b) => (a.harga || 0) - (b.harga || 0));
      } else if (sortBy === 'harga-desc') {
        filteredJournals.sort((a, b) => (b.harga || 0) - (a.harga || 0));
      } else if (sortBy === 'akreditasi') {
        const order = {'Sinta 1': 1, 'Sinta 2': 2, 'Sinta 3': 3, 'Sinta 4': 4, 'Sinta 5': 5, 'Sinta 6': 6};
        filteredJournals.sort((a, b) => (order[a.akreditasi] || 99) - (order[b.akreditasi] || 99));
      }

      currentPage = 1;
      renderTable();
      renderPagination();
    }

    function renderTable() {
      const container = document.getElementById('jurnalTable');
      document.getElementById('resultCount').textContent = filteredJournals.length;
      
      if (filteredJournals.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-title">Tidak ada jurnal ditemukan</div><p class="empty-state-text">Coba ubah filter pencarian Anda</p></div>';
        return;
      }

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = filteredJournals.slice(start, end);

      let html = '<div class="table-container"><table class="table"><thead><tr>';
      html += '<th>Nama Jurnal</th><th>Instansi</th><th>Akreditasi</th><th>Scope</th><th>Harga</th><th>Fast Track</th><th>Link</th>';
      html += '</tr></thead><tbody>';

      pageData.forEach(j => {
        html += `<tr>
          <td><strong style="color: var(--text-primary);">${j.nama}</strong></td>
          <td>${j.instansi}</td>
          <td><span class="badge badge-primary">${j.akreditasi}</span></td>
          <td><span class="badge badge-secondary">${j.scope}</span></td>
          <td style="white-space: nowrap;">${formatCurrency(j.harga)}</td>
          <td>${j.fastTrack ? '<span class="badge badge-success">Ya</span>' : '<span class="badge badge-gray">Tidak</span>'}</td>
          <td>${j.link ? `<a href="${j.link}" target="_blank" class="btn btn-sm btn-outline">Visit</a>` : '-'}</td>
        </tr>`;
      });

      html += '</tbody></table></div>';
      container.innerHTML = html;
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredJournals.length / itemsPerPage);
      const container = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        container.innerHTML = '';
        return;
      }

      let html = '<div class="pagination">';
      html += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Prev</button>`;
      
      for (let i = 1; i <= Math.min(totalPages, 5); i++) {
        html += `<button class="pagination-btn ${currentPage === i ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
      }
      
      html += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;
      html += '</div>';
      
      container.innerHTML = html;
    }

    window.changePage = (page) => {
      const totalPages = Math.ceil(filteredJournals.length / itemsPerPage);
      if (page < 1 || page > totalPages) return;
      currentPage = page;
      renderTable();
      renderPagination();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Event listeners
    document.getElementById('searchInput').addEventListener('input', applyFilters);
    document.getElementById('filterAkreditasi').addEventListener('change', applyFilters);
    document.getElementById('filterScope').addEventListener('change', applyFilters);
    document.getElementById('filterHarga').addEventListener('change', applyFilters);
    document.getElementById('filterFastTrack').addEventListener('change', applyFilters);
    document.getElementById('sortBy').addEventListener('change', applyFilters);

    document.getElementById('resetFilters').addEventListener('click', () => {
      document.getElementById('searchInput').value = '';
      document.getElementById('filterAkreditasi').value = '';
      document.getElementById('filterScope').value = '';
      document.getElementById('filterHarga').value = '';
      document.getElementById('filterFastTrack').value = '';
      document.getElementById('sortBy').value = 'nama';
      applyFilters();
    });

    document.getElementById('exportExcel').addEventListener('click', () => {
      try {
        exportToExcel(filteredJournals, 'PubGlow_Jurnal');
        showSuccess('Data berhasil di-export ke Excel');
      } catch (error) {
        showError('Gagal export data');
      }
    });

    document.getElementById('exportPDF').addEventListener('click', () => {
      try {
        exportToPDF(filteredJournals, 'PubGlow_Jurnal');
        showSuccess('Data berhasil di-export ke PDF');
      } catch (error) {
        showError('Gagal export data');
      }
    });

    loadJournals();
  </script>
</body>
</html>