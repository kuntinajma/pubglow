<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kontribusi Artikel - PubGlow</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 60px 0;
      margin-bottom: 40px;
    }
    
    .header h1 {
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .form-container {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      max-width: 900px;
      margin: 0 auto 40px;
    }
    
    .form-label {
      font-weight: 600;
      color: #333;
    }
    
    #editor-container {
      min-height: 300px;
      background: white;
    }
    
    .ql-toolbar {
      background: #f8f9fa;
      border-radius: 8px 8px 0 0;
    }
    
    .ql-container {
      border-radius: 0 0 8px 8px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 16px;
    }
    
    .btn-submit {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      border: none;
      color: white;
      padding: 12px 40px;
      font-weight: 600;
      border-radius: 8px;
      transition: transform 0.3s;
    }
    
    .btn-submit:hover {
      transform: translateY(-2px);
      color: white;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="container text-center">
      <h1>‚úçÔ∏è Kontribusi Artikel</h1>
      <p class="mb-0">Bagikan pengetahuan dan pengalaman Anda dalam dunia publikasi ilmiah</p>
    </div>
  </div>

  <div class="container">
    <div class="form-container">
      <div class="alert alert-info mb-4">
        <strong>üìù Informasi:</strong> Artikel yang Anda kirimkan akan direview oleh admin sebelum dipublikasikan.
      </div>

      <!-- Success Message -->
      <div id="successMessage" class="alert alert-success d-none" role="alert">
        <h5>‚úÖ Berhasil Terkirim!</h5>
        <p class="mb-0">Terima kasih atas kontribusi artikel Anda. Artikel akan segera direview oleh tim kami.</p>
      </div>

      <!-- Form -->
      <form id="formSubmit">
        <h4 class="mb-4">Informasi Kontributor</h4>
        
        <!-- Nama Kontributor -->
        <div class="mb-3">
          <label for="contributorName" class="form-label">Nama Lengkap *</label>
          <input type="text" class="form-control" id="contributorName" required
            placeholder="Nama lengkap Anda">
        </div>

        <!-- Email Kontributor -->
        <div class="mb-3">
          <label for="contributorEmail" class="form-label">Email *</label>
          <input type="email" class="form-control" id="contributorEmail" required
            placeholder="email@example.com">
          <small class="form-text text-muted">Email untuk notifikasi status review</small>
        </div>

        <!-- Publikasikan Nama -->
        <div class="mb-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="publishName" checked>
            <label class="form-check-label" for="publishName">
              <strong>Publikasikan nama saya sebagai penulis artikel</strong>
            </label>
          </div>
          <small class="form-text text-muted">
            Jika tidak dicentang, artikel akan dipublikasikan atas nama "Tim PubGlow"
          </small>
        </div>

        <hr class="my-4">
        <h4 class="mb-4">Informasi Artikel</h4>

        <!-- Judul -->
        <div class="mb-3">
          <label for="judul" class="form-label">Judul Artikel *</label>
          <input type="text" class="form-control" id="judul" required
            placeholder="5 Tips Sukses Publikasi di Jurnal Internasional">
        </div>

        <!-- Kategori -->
        <div class="mb-3">
          <label for="kategori" class="form-label">Kategori *</label>
          <select class="form-select" id="kategori" required>
            <option value="">-- Pilih Kategori --</option>
          </select>
        </div>

        <!-- Konten (WYSIWYG Editor) -->
        <div class="mb-3">
          <label class="form-label">Konten Artikel *</label>
          <div id="editor-container"></div>
          <small class="form-text text-muted">
            Gunakan toolbar untuk format teks: bold, italic, heading, list, dll.
          </small>
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-submit" id="btnSubmit">
            <span id="btnText">üì§ Kirim Artikel</span>
            <span id="btnSpinner" class="d-none">
              <span class="spinner-border spinner-border-sm"></span> Mengirim...
            </span>
          </button>
          <a href="index.html" class="btn btn-secondary">Batal</a>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script type="module">
    import { db } from './js/firebase.js';
    import { collection, addDoc, getDocs, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // Initialize Quill Editor
    const quill = new Quill('#editor-container', {
      theme: 'snow',
      placeholder: 'Tulis konten artikel di sini...',
      modules: {
        toolbar: [
          [{ 'header': [2, 3, false] }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'color': [] }, { 'background': [] }],
          ['link'],
          ['clean']
        ]
      }
    });

    // Auto-generate slug
    document.getElementById('judul').addEventListener('input', (e) => {
      // Slug will be generated server-side or by admin
    });

    // Load kategori
    async function loadKategori() {
      try {
        const snapshot = await getDocs(collection(db, 'kategori_artikel'));
        
        if (snapshot.empty) {
          document.getElementById('kategori').innerHTML = 
            '<option value="">Kategori belum tersedia</option>';
          return;
        }

        let html = '<option value="">-- Pilih Kategori --</option>';
        snapshot.forEach(doc => {
          const kategori = doc.data().nama;
          html += `<option value="${kategori}">${kategori}</option>`;
        });
        document.getElementById('kategori').innerHTML = html;
      } catch (error) {
        console.error('Error loading kategori:', error);
      }
    }

    loadKategori();

    // Handle submit
    document.getElementById('formSubmit').addEventListener('submit', async (e) => {
      e.preventDefault();

      // Get Quill content
      const konten = quill.root.innerHTML.trim();
      
      if (!konten || konten === '<p><br></p>') {
        alert('Konten artikel tidak boleh kosong!');
        return;
      }

      // Determine author name
      const publishName = document.getElementById('publishName').checked;
      const authorName = publishName ? 
        document.getElementById('contributorName').value.trim() : 
        'Tim PubGlow';

      // Auto-generate slug from title
      const slug = document.getElementById('judul').value
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');

      const data = {
        // Contributor info
        contributor: {
          name: document.getElementById('contributorName').value.trim(),
          email: document.getElementById('contributorEmail').value.trim(),
          publishName: publishName
        },
        // Article info
        judul: document.getElementById('judul').value.trim(),
        slug: slug,
        kategori: document.getElementById('kategori').value,
        penulis: authorName,
        konten: konten,
        // Submission metadata
        status: 'pending',
        submittedAt: serverTimestamp()
      };

      // Show loading
      document.getElementById('btnText').classList.add('d-none');
      document.getElementById('btnSpinner').classList.remove('d-none');
      document.getElementById('btnSubmit').disabled = true;

      try {
        await addDoc(collection(db, 'article_submissions'), data);
        
        // Show success
        document.getElementById('formSubmit').classList.add('d-none');
        document.getElementById('successMessage').classList.remove('d-none');
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // Redirect after 3 seconds
        setTimeout(() => {
          window.location.href = 'articles.html';
        }, 3000);
      } catch (error) {
        console.error('Error submitting:', error);
        alert('Gagal mengirim artikel. Silakan coba lagi.');
        
        // Reset button
        document.getElementById('btnText').classList.remove('d-none');
        document.getElementById('btnSpinner').classList.add('d-none');
        document.getElementById('btnSubmit').disabled = false;
      }
    });
  </script>
</body>
</html>